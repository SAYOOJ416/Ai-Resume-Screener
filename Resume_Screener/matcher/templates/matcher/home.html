{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>AI Resume Screener</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col items-center justify-start py-10">

    <div class="w-full max-w-2xl p-6 bg-white rounded-xl shadow-md border">
        <h1 class="text-2xl font-bold text-center mb-6">AI Resume Screener</h1>

        <!-- Form -->
        <form method="POST" enctype="multipart/form-data" class="space-y-4">
            {% csrf_token %}

            <div>
                <label class="block font-medium mb-1" for="resume">Upload Resume (PDF)</label>
                <input type="file" name="resume" id="resume" accept=".pdf" class="w-full border rounded-lg p-2">
            </div>

            <div>
                <label class="block font-medium mb-1" for="job_description">Job Description</label>
                <textarea name="job_description" id="job_description" rows="5"
                          class="w-full border rounded-lg p-2"
                          placeholder="Paste the job description here"></textarea>
            </div>

            <button type="submit" 
                    class="w-full bg-blue-600 text-white py-3 rounded-xl hover:bg-blue-700 transition-colors">
                Analyze Resume
            </button>
        </form>

        <!-- Error message -->
        {% if error %}
        <p class="text-red-600 font-semibold text-center mt-4">{{ error }}</p>
        {% endif %}

        <!-- Result block -->
       {% if score is not None %}
<div class="mt-8 p-6 bg-gray-50 rounded-xl border">

    <!-- Title -->
    <h3 class="text-xl font-semibold text-gray-800 text-center">
        Resume Match Result
    </h3>

    <!-- Percentage + Progress Bar -->
    <div class="mt-4 text-center">
        <span id="score-text" class="text-5xl font-bold text-green-600">0%</span>
        <p class="text-gray-500 mt-1">Overall Match Score</p>

        <div class="mt-6 w-full bg-gray-200 rounded-full h-3">
            <div id="progress-bar" class="bg-green-500 h-3 rounded-full transition-all duration-1000" style="width:0%;"></div>
        </div>
    </div>

    <!-- Interpretation -->
    <div class="mt-5 text-center">
        {% if score >= 80 %}
            <span class="text-green-600 font-semibold">Excellent match üéØ</span>
        {% elif score >= 60 %}
            <span class="text-yellow-600 font-semibold">Good match üëç</span>
        {% else %}
            <span class="text-red-600 font-semibold">Needs improvement ‚ö†Ô∏è</span>
        {% endif %}
    </div>

    <!-- Skills badges -->
    {% if matched_skills or missing_skills %}
    <div class="mt-6 p-4 bg-white rounded-xl border">

        <h4 class="text-lg font-semibold mb-2">Skills Analysis</h4>

        <!-- Matched skills -->
        {% if matched_skills %}
        <p class="mb-1 font-medium text-green-700">Matched Skills:</p>
        <div class="flex flex-wrap gap-2 mb-4">
            {% for skill in matched_skills %}
                <span class="px-3 py-1 bg-green-200 text-green-800 rounded-full text-sm">{{ skill }}</span>
            {% endfor %}
        </div>
        {% endif %}

        <!-- Missing skills -->
        {% if missing_skills %}
        <p class="mb-1 font-medium text-red-700">Missing Skills:</p>
        <div class="flex flex-wrap gap-2">
            {% for skill in missing_skills %}
                <span class="px-3 py-1 bg-red-200 text-red-800 rounded-full text-sm">{{ skill }}</span>
            {% endfor %}
        </div>
        {% endif %}

    </div>
    {% endif %}
</div>
{% endif %}

    </div>
   
<script>
document.addEventListener("DOMContentLoaded", function() {
    {% if score is not None %}
    const score = parseFloat("{{ score|floatformat:2 }}");
    const scoreText = document.getElementById("score-text");
    const progressBar = document.getElementById("progress-bar");

    let current = 0;
    const step = score / 100;

    function animate() {
        current += step;
        if(current >= score){
            current = score;
        }
        scoreText.textContent = Math.round(current) + "%";
        progressBar.style.width = current + "%";

        if(current < score){
            requestAnimationFrame(animate);
        }
    }

    animate();
    {% endif %}
});
</script>


</body>
</html>
